<!-- {{ ansible_managed }} -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>User</key>
    <string>{{ node_exporter_system_user }}</string>

    <key>Group</key>
    <string>{{ node_exporter_system_group }}</string>

    <key>Label</key>
    <string>node_exporter</string>

    <key>ProgramArguments</key>
    <array>
      <string>/usr/local/bin/node_exporter</string>
      {% for collector in node_exporter_enabled_collectors -%}
      {%   if not collector is mapping -%}
      <string>--collector.{{ collector }}</string>
      {%   else -%}
      {%     set name, options = (collector.items()|list)[0] -%}
      {%     for k,v in options|dictsort -%}
      <string>--collector.{{ name }}.{{ k }}={{ v }}</string>
      {%     endfor -%}
      {%   endif -%}
      {% endfor -%}
      {% for collector in node_exporter_disabled_collectors -%}
      <string>--no-collector.{{ collector }}</string>
      {% endfor -%}
      <string>--web.listen-address={{ node_exporter_web_listen_address }}</string>
    </array>

    <key>StandardOutPath</key>
    <string>/var/log/node_exporter.log</string>

    <key>StandardErrorPath</key>
    <string>/var/log/node_exporter.log</string>

    <key>RunAtLoad</key>
    <true/>

    <key>KeepAlive</key>
	  <true/>

</dict>
</plist>
